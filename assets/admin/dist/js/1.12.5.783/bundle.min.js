/*! Copyright WeeblrPress - Weeblr,llc 2020 - Licence: http://www.gnu.org/copyleft/gpl.html GNU/GPL */
!function(e,a,b,d){"use strict";var s=".js-wbamp-disqus-connect-button",t=".js-wbamp-disqus-download-button",n=".js-wbamp-setting-submit",_=64,p=32,o=[];function r(e){e.preventDefault();var a=d(this),t=d("#js-wbamp-disqus-connect-msg");t.empty();var s=d("#weeblramp___weeblramp_user__access_key").val();if(!s||s.length!=_&&s.length!=p)w(t,"Please enter and save your WeeblrPress access key on the <strong>System</strong> tab of this page before trying to connect to WeeblrPress.","wbamp-ajax-response-msg-failure","wbamp-ajax-response-msg-success",8e3);else{var n=d("#weeblramp___weeblramp_user__comment_disqus_shortname"),o=n.val();if(o){var r="js-wbamp-disqus-connect-spinner",i=d("#weeblramp___weeblramp_user__comment_disqus_endpoint"),c=d("#weeblramp___weeblramp_user__disqus_connect_state"),l="connected"==c.val()?"delete":"update",b=d("#weeblramp___weeblramp_user__comment_disqus_shortname-button"),m={action:"wblib_config_action",request:l,config_item:"comment_disqus_shortname",_ajax_nonce:wblib.ajax_nonces.comment_disqus_shortname||"",shortname:o};u(t),wblib.spinner.start(r,{class:"wbl-spinner-css-12"}),a.prop("disabled","disabled"),d.post(ajaxurl,m).done(function(e){if(wblib.spinner.stop(r),e.success)c.val(e.data.new_connect_state),"connected"==e.data.new_connect_state?(n.attr("disabled","disabled"),i.attr("disabled","disabled"),c.val("connected")):(n.removeAttr("disabled"),i.removeAttr("disabled"),i.empty(),c.val("not_connected")),i.val(e.data.new_endpoint),b.html(e.data.new_button_label),w(t,e.data.message,"wbamp-ajax-response-msg-success","wbamp-ajax-response-msg-failure",5e3);else{var s=e.data&&e.data[0]&&e.data[0].message?e.data[0].message:"Sorry we cannot contact the WeeblPress servers. Please try again later.";w(t,s,"wbamp-ajax-response-msg-failure","wbamp-ajax-response-msg-success")}a.prop("disabled",!1)})}else w(t,"Please enter your disqus shortname first.","wbamp-ajax-response-msg-failure","wbamp-ajax-response-msg-success",4e3)}}function i(e){e.preventDefault();var s=d(this),o=d("#js-wbamp-disqus-connect-msg");o.empty();var a=d("#weeblramp___weeblramp_user__comment_disqus_shortname").val();if(a){var r="js-wbamp-disqus-connect-spinner";u(o),wblib.spinner.start(r,{class:"wbl-spinner-css-12"}),s.prop("disabled","disabled");var i=Date.now(),t=ajaxurl+"?action=wblib_config_action&request=download_relay_file&config_item=comment_disqus_shortname&shortname="+a+"&_ajax_nonce="+(wblib.ajax_nonces.comment_disqus_shortname||"")+"&id="+i;d("<iframe>").hide().prop("src",t).appendTo("body");var c=s,l=function(){var e=Date.now(),s=(e-i)/1e3,a="wbamp_dl_success="+i,t=-1<b.cookie.indexOf(a);t&&console.log("Successful download, response after "+s+" seconds");var n=i+5e3<e;n&&(console.log("Download timed out after "+s+" seconds"),w(o,"Sorry we cannot contact the WeeblPress servers. Please try again later.","wbamp-ajax-response-msg-failure","wbamp-ajax-response-msg-success")),t||n?(c.removeProp("disabled"),wblib.spinner.stop(r)):setTimeout(l,500)};setTimeout(l,500)}else w(o,"Please enter your disqus shortname first.","wbamp-ajax-response-msg-failure","wbamp-ajax-response-msg-success",4e3)}function u(e){e.hide(),o.length&&(o.forEach(function(e){e&&clearTimeout(e)}),o=[])}function c(e){d("#weeblramp___weeblramp_user__comment_disqus_shortname").removeAttr("disabled"),d("#weeblramp___weeblramp_user__comment_disqus_endpoint").removeAttr("disabled")}function w(e,s,a,t,n){e.addClass(a).removeClass(t).html(s).fadeIn(),n&&o.push(setTimeout(function(){e.empty()},n))}d(b).ready(function(){try{!function(){d(".js-wbamp-no-javascript").hide(),d(".wblib-settings-accordion").accordion({heightStyle:"content",collapsible:!0,active:!1});var e=d("#wblib-settings-tabs"),t=e.data("page-id"),n=wblib.page_infos.blog_id,s=a.wblib.getCookie(n+"_"+t+"_active_tab");e.tabs({activate:function(e,s){s.oldTab.find(".nav-tab").removeClass("nav-tab-active"),s.newTab.find(".nav-tab").addClass("nav-tab-active");var a=s.newTab.index();wblib.setCookie(n+"_"+t+"_active_tab",a,1/0),s.newTab.find(".js-wblib-tab-upgrade").length?d(".submit").hide():d(".submit").show()}}).fadeIn(function(){e.tabs({active:s})})}(),d(s).on("click",r),d(t).on("click",i),d(n).on("click",c)}catch(e){console.log("weeblrAMP: error setting up javascript: "+e.message)}})}(window.weeblramp=window.weeblramp||{},window,document,jQuery);
